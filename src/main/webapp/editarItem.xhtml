<ui:composition template="vercel.xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">

    <ui:define name="title">
        Editar Partida
    </ui:define>

    <ui:define name="content">

        <h:form id="formEditarItem">

            <p:growl id="messages"
                     showDetail="false"/>

            <!-- Card Time 1 -->
            <p:card styleClass="glass-card mb-4">
                <f:facet name="title">
                    <div class="flex align-items-center">
                        <i class="pi pi-users mr-2" style="color: var(--accent)"></i>
                        <span>#{managerPesquisarEstatisticas.itemPartida.team1.nome}</span>
                    </div>
                </f:facet>

                <p:dataTable id="partidaTime1"
                             value="#{managerPesquisarEstatisticas.estsTime1Visualizar}"
                             var="ests1"
                             paginator="true"
                             editable="true"
                             editMode="cell" 
                             widgetVar="estsPartida"
                             styleClass="elegant-table"
                             paginatorPosition="bottom"
                             paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink}"
                             currentPageReportTemplate="{currentPage} de {totalPages}"
                             rows="10"
                             rowsPerPageTemplate="5,10,15">

                    <p:column headerText="Opções" width="80px" style="text-align: center;">
                        <p:button title="Visualizar Player"
                                  icon="pi pi-eye"
                                  styleClass="p-button-text p-button-sm"
                                  href="visualizarPlayer.xhtml?id=#{ests1.player.id}"/>
                    </p:column>

                    <p:column headerText="Nome" width="30%">
                        <span style="color: var(--text-100);">
                            #{ests1.player.nome} '#{ests1.player.nick}' #{ests1.player.sobreNome}
                        </span>
                    </p:column>                            

                    <p:column headerText="Kills">
                        <p:cellEditor>
                            <f:facet name="output">
                                <h:outputText value="#{ests1.kills}" style="color: var(--text-100);"/>
                            </f:facet>
                            <f:facet name="input">
                                <p:inputText value="#{ests1.kills}" styleClass="dark-input-edit"/>
                            </f:facet>
                        </p:cellEditor>
                    </p:column>               

                    <p:column headerText="Deaths">
                        <p:cellEditor>
                            <f:facet name="output">
                                <h:outputText value="#{ests1.deaths}" style="color: var(--text-100);"/>
                            </f:facet>
                            <f:facet name="input">
                                <p:inputText value="#{ests1.deaths}" styleClass="dark-input-edit"/>
                            </f:facet>
                        </p:cellEditor>
                    </p:column>   

                    <p:column headerText="Assists">
                        <p:cellEditor>
                            <f:facet name="output">
                                <h:outputText value="#{ests1.assists}" style="color: var(--text-100);"/>
                            </f:facet>
                            <f:facet name="input">
                                <p:inputText value="#{ests1.assists}" styleClass="dark-input-edit"/>
                            </f:facet>
                        </p:cellEditor>
                    </p:column>  
                </p:dataTable>
            </p:card>

            <!-- Card Time 2 -->
            <p:card styleClass="glass-card mb-4">
                <f:facet name="title">
                    <div class="flex align-items-center">
                        <i class="pi pi-users mr-2" style="color: var(--accent)"></i>
                        <span>#{managerPesquisarEstatisticas.itemPartida.team2.nome}</span>
                    </div>
                </f:facet>

                <p:dataTable id="partidaTime2"
                             value="#{managerPesquisarEstatisticas.estsTime2Visualizar}"
                             var="ests2"
                             paginator="true"
                             paginatorPosition="bottom"
                             editable="true"
                             editMode="cell" 
                             widgetVar="estsPartida2"
                             styleClass="elegant-table"
                             paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink}"
                             currentPageReportTemplate="{currentPage} de {totalPages}"
                             rows="10"
                             rowsPerPageTemplate="5,10,15">

                    <p:column headerText="Opções" width="80px" style="text-align: center;">
                        <p:button title="Visualizar Player"
                                  icon="pi pi-eye"
                                  styleClass="p-button-text p-button-sm"
                                  href="visualizarPlayer.xhtml?id=#{ests2.player.id}"/>
                    </p:column>

                    <p:column headerText="Nome" width="30%">
                        <span style="color: var(--text-100);">
                            #{ests2.player.nome} '#{ests2.player.nick}' #{ests2.player.sobreNome}
                        </span>
                    </p:column>                            

                    <p:column headerText="Kills">
                        <p:cellEditor>
                            <f:facet name="output">
                                <h:outputText value="#{ests2.kills}" style="color: var(--text-100);"/>
                            </f:facet>
                            <f:facet name="input">
                                <p:inputText value="#{ests2.kills}" styleClass="dark-input-edit"/>
                            </f:facet>
                        </p:cellEditor>
                    </p:column>                        

                    <p:column headerText="Deaths">
                        <p:cellEditor>
                            <f:facet name="output">
                                <h:outputText value="#{ests2.deaths}" style="color: var(--text-100);"/>
                            </f:facet>
                            <f:facet name="input">
                                <p:inputText value="#{ests2.deaths}" styleClass="dark-input-edit"/>
                            </f:facet>
                        </p:cellEditor>
                    </p:column>

                    <p:column headerText="Assists">
                        <p:cellEditor>
                            <f:facet name="output">
                                <h:outputText value="#{ests2.assists}" style="color: var(--text-100);"/>
                            </f:facet>
                            <f:facet name="input">
                                <p:inputText value="#{ests2.assists}" styleClass="dark-input-edit"/>
                            </f:facet>
                        </p:cellEditor>
                    </p:column>                
                </p:dataTable>
            </p:card>

            <!-- Ações -->
            <div class="flex justify-content-center gap-3 mb-4">   
                <p:commandButton value="Gerar Estatísticas" 
                                 icon="pi pi-chart-bar"
                                 styleClass="btn-gerar-estatisticas"
                                 action="#{managerPesquisarEstatisticas.gerarEsts()}"
                                 process="@form"
                                 update="@form"/>
                <p:commandButton value="Salvar" 
                                 icon="pi pi-check"
                                 styleClass="btn-salvar-item"
                                 onclick="PF('confirmacaoEdicaoPartida').show();"/>
                <p:commandButton value="Cancelar" 
                                 icon="pi pi-times"
                                 styleClass="btn-cancelar-item"
                                 actionListener="#{managerPesquisarEstatisticas.cancelar()}"/>
            </div>

            <!-- Dialog de Confirmação -->
            <p:dialog id="confirmacaoEdicaoPartida"
                      widgetVar="confirmacaoEdicaoPartida"
                      header="Placar do mapa"
                      modal="true"
                      resizable="false"
                      draggable="false"
                      closeOnEscape="true"
                      showEffect="fade"
                      hideEffect="fade"
                      styleClass="dark-dialog">

                <div class="flex flex-column gap-3" style="padding: 1rem 0;">
                    <div class="flex align-items-center justify-content-between gap-3">
                        <p:outputLabel value="#{managerPesquisarEstatisticas.itemPartida.team1.nome}" 
                                     for="nomeTime1"
                                     style="color: var(--text-100); font-weight: 600; min-width: 200px;"/>
                        <p:inputText id="nomeTime1" 
                                   value="#{managerPesquisarEstatisticas.itemPartida.scoreT1}"
                                   styleClass="dark-input-edit"
                                   style="width: 100px; text-align: center;"/>
                    </div>
                    
                    <div class="flex align-items-center justify-content-between gap-3">
                        <p:outputLabel value="#{managerPesquisarEstatisticas.itemPartida.team2.nome}" 
                                     for="nomeTime2"
                                     style="color: var(--text-100); font-weight: 600; min-width: 200px;"/>
                        <p:inputText id="nomeTime2" 
                                   value="#{managerPesquisarEstatisticas.itemPartida.scoreT2}"
                                   styleClass="dark-input-edit"
                                   style="width: 100px; text-align: center;"/>
                    </div>

                    <div class="flex justify-content-end gap-2" style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border);">
                        <p:commandButton value="Cancelar"
                                         icon="pi pi-times"
                                         styleClass="btn-cancelar-item"
                                         oncomplete="PF('confirmacaoEdicaoPartida').hide();"/>

                        <p:commandButton value="Salvar"
                                         icon="pi pi-check"
                                         styleClass="btn-salvar-item"
                                         process="@form"
                                         update="@form"
                                         actionListener="#{managerPesquisarEstatisticas.salvar()}"
                                         onclick="desabilitarBotoes(true);" 
                                         oncomplete="desabilitarBotoes(false); PF('confirmacaoEdicaoPartida').hide();"/>
                    </div>
                </div>
            </p:dialog>

            <style>
                /* Estilos para inputs de edição na tabela (modo dark) */
                .dark-input-edit.ui-inputtext,
                .dark-input-edit {
                    background: rgba(255,255,255,0.08) !important;
                    border: 1px solid rgba(255,255,255,0.15) !important;
                    color: var(--text-100) !important;
                    border-radius: 6px !important;
                    padding: 0.5rem 0.75rem !important;
                }
                
                .dark-input-edit.ui-inputtext:focus,
                .dark-input-edit:focus {
                    background: rgba(255,255,255,0.12) !important;
                    border-color: var(--accent) !important;
                    box-shadow: 0 0 0 2px rgba(0,225,255,0.2) !important;
                    outline: none !important;
                }

                /* Dialog dark */
                .dark-dialog.ui-dialog {
                    background: linear-gradient(180deg, var(--bg-800), var(--bg-900)) !important;
                    border: 1px solid var(--border) !important;
                }

                .dark-dialog .ui-dialog-titlebar {
                    background: rgba(255,255,255,0.04) !important;
                    border-bottom: 1px solid var(--border) !important;
                    color: var(--text-100) !important;
                }

                .dark-dialog .ui-dialog-content {
                    background: transparent !important;
                    color: var(--text-100) !important;
                }

                /* Ajustes para células editáveis */
                .elegant-table .ui-editable-column {
                    position: relative;
                }

                .elegant-table .ui-cell-editor-input {
                    width: 100%;
                }
                
                /* Botões Elegantes - Estilo Consistente */
                .btn-gerar-estatisticas,
                .btn-salvar-item,
                .btn-cancelar-item {
                    display: inline-flex !important;
                    align-items: center !important;
                    gap: 0.5rem !important;
                    padding: 0.625rem 1.25rem !important;
                    border-radius: 16px !important;
                    font-size: 0.8rem !important;
                    font-weight: 600 !important;
                    letter-spacing: 0.3px !important;
                    text-transform: uppercase !important;
                    transition: all 0.3s ease !important;
                    position: relative !important;
                    overflow: hidden !important;
                }
                
                .btn-gerar-estatisticas::before,
                .btn-salvar-item::before,
                .btn-cancelar-item::before {
                    content: '';
                    position: absolute;
                    top: 0;
                    left: -100%;
                    width: 100%;
                    height: 100%;
                    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.15), transparent);
                    transition: left 0.5s ease;
                }
                
                .btn-gerar-estatisticas:hover::before,
                .btn-salvar-item:hover::before,
                .btn-cancelar-item:hover::before {
                    left: 100%;
                }
                
                .btn-gerar-estatisticas .pi,
                .btn-salvar-item .pi,
                .btn-cancelar-item .pi {
                    font-size: 0.875rem !important;
                }
                
                .btn-gerar-estatisticas .ui-button-text,
                .btn-salvar-item .ui-button-text,
                .btn-cancelar-item .ui-button-text {
                    display: flex !important;
                    align-items: center !important;
                    gap: 0.5rem !important;
                }
                
                /* Botão Gerar Estatísticas */
                .btn-gerar-estatisticas {
                    background: linear-gradient(135deg, rgba(168, 85, 247, 0.15), rgba(168, 85, 247, 0.1)) !important;
                    border: 1.5px solid rgba(168, 85, 247, 0.35) !important;
                    color: #a855f7 !important;
                    box-shadow: 0 2px 6px rgba(168, 85, 247, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.08) !important;
                }
                
                .btn-gerar-estatisticas:hover {
                    background: linear-gradient(135deg, rgba(168, 85, 247, 0.2), rgba(168, 85, 247, 0.15)) !important;
                    border-color: rgba(168, 85, 247, 0.45) !important;
                    box-shadow: 0 4px 10px rgba(168, 85, 247, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.1) !important;
                    transform: translateY(-1px) !important;
                }
                
                .btn-gerar-estatisticas .pi {
                    filter: drop-shadow(0 0 2px rgba(168, 85, 247, 0.5));
                }
                
                /* Botão Salvar */
                .btn-salvar-item {
                    background: linear-gradient(135deg, rgba(34, 197, 94, 0.15), rgba(34, 197, 94, 0.1)) !important;
                    border: 1.5px solid rgba(34, 197, 94, 0.35) !important;
                    color: var(--success) !important;
                    box-shadow: 0 2px 6px rgba(34, 197, 94, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.08) !important;
                }
                
                .btn-salvar-item:hover {
                    background: linear-gradient(135deg, rgba(34, 197, 94, 0.2), rgba(34, 197, 94, 0.15)) !important;
                    border-color: rgba(34, 197, 94, 0.45) !important;
                    box-shadow: 0 4px 10px rgba(34, 197, 94, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.1) !important;
                    transform: translateY(-1px) !important;
                }
                
                .btn-salvar-item .pi {
                    filter: drop-shadow(0 0 2px rgba(34, 197, 94, 0.5));
                }
                
                /* Botão Cancelar */
                .btn-cancelar-item {
                    background: linear-gradient(135deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.05)) !important;
                    border: 1.5px solid rgba(255, 255, 255, 0.2) !important;
                    color: var(--text-200) !important;
                    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1), inset 0 1px 0 rgba(255, 255, 255, 0.05) !important;
                }
                
                .btn-cancelar-item:hover {
                    background: linear-gradient(135deg, rgba(255, 255, 255, 0.12), rgba(255, 255, 255, 0.08)) !important;
                    border-color: rgba(255, 255, 255, 0.3) !important;
                    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15), inset 0 1px 0 rgba(255, 255, 255, 0.08) !important;
                    transform: translateY(-1px) !important;
                    color: var(--text-100) !important;
                }
            </style>

        </h:form>

    </ui:define>

</ui:composition>
