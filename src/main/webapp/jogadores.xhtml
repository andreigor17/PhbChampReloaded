<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                template="vercel.xhtml">

    <ui:define name="content">
        <div class="section-header">
            <h1 class="section-title">Jogadores</h1>
            <p:button value="Novo Jogador" icon="pi pi-plus" outcome="criarJogador.xhtml" styleClass="p-button-outlined full-stats-btn" />
        </div>
        
        <p:card styleClass="glass-card">
            <h:form id="jogadoresForm">
                <!-- Filtros em linha -->
                <div class="filter-grid">
                    <!-- Busca por nome -->
                    <div class="filter-field">
                        <label class="filter-label">
                            <i class="pi pi-search"></i>
                            <span>Nome do Jogador</span>
                        </label>
                        <p:inputText id="searchInput"
                                     placeholder="Digite o nome..."
                                     styleClass="filter-input"
                                     value="#{managerPlayer.termoBusca}">
                            <p:ajax event="keyup"
                                    listener="#{managerPlayer.pesquisarPlayer()}"
                                    update="jogadoresTable initialMessage noResultsMessage loadingIndicator"
                                    delay="500"
                                    global="false" />
                        </p:inputText>
                    </div>

                    <!-- Botão limpar -->
                    <div class="filter-field">
                        <label class="filter-label filter-label-empty">
                            <span></span>
                        </label>
                        <p:commandButton value="Limpar Filtros"
                                         icon="pi pi-times"
                                         styleClass="clear-btn"
                                         actionListener="#{managerPlayer.limparBusca()}"
                                         update="searchInput jogadoresTable initialMessage noResultsMessage"
                                         process="@this"
                                         global="false" />
                    </div>
                </div>
                
                <!-- Indicador de carregamento -->
                <p:outputPanel id="loadingIndicator">
                    <div class="text-center p-3" style="display: #{managerPlayer.buscando ? 'block' : 'none'};">
                        <p:progressBar style="width:50px;height:50px"  animationDuration="5" />
                        <div class="mt-2">Buscando jogadores...</div>
                    </div>
                </p:outputPanel>
                
                <!-- Mensagem quando não há resultados -->
                <p:outputPanel id="noResultsMessage">
                    <div class="text-center p-5" style="display: #{managerPlayer.semResultados ? 'block' : 'none'};">
                        <i class="pi pi-search" style="font-size: 3rem; color: #ccc; margin-bottom: 1rem;"></i>
                        <h3>Nenhum jogador encontrado</h3>
                        <p>Tente usar termos diferentes na sua busca.</p>
                    </div>
                </p:outputPanel>
                
                <!-- Mensagem inicial -->
                <p:outputPanel id="initialMessage">
                    <div class="text-center p-5" style="display: #{managerPlayer.estadoInicial ? 'block' : 'none'};">
                        <i class="pi pi-users" style="font-size: 3rem; color: #ccc; margin-bottom: 1rem;"></i>
                        <h3>Digite para buscar jogadores</h3>
                        <p>Os resultados aparecerão aqui conforme você digita.</p>
                    </div>
                </p:outputPanel>
                
                <p:dataTable id="jogadoresTable" var="jogador" value="#{managerPlayer.players}" 
                            styleClass="elegant-table" 
                            style="display: #{managerPlayer.temResultados ? 'table' : 'none'};"
                            emptyMessage="Nenhum jogador encontrado"
                            paginator="true" rows="10"
                            rowsPerPageTemplate="10,20,50"
                            paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                            currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} jogadores">
                    
                    <p:column headerText="Foto" style="width: 80px; text-align: center;">
                        <div class="player-avatar-small">
                            <p:graphicImage value="image/#{jogador.anexo.nome}" rendered="#{jogador.anexo ne null}" styleClass="player-photo-small" />
                            <h:panelGroup rendered="#{jogador.anexo eq null}">
                                <div class="player-photo-placeholder-small dark">
                                    <i class="pi pi-user"></i>
                                </div>
                            </h:panelGroup>
                        </div>
                    </p:column>
                    
                    <p:column headerText="Nome" sortBy="#{jogador.nome}">
                        <h:outputText value="#{jogador.nome}" />
                    </p:column>
                    
                    <p:column headerText="Nickname" sortBy="#{jogador.nick}">
                        <h:outputText value="#{jogador.nick}" />
                    </p:column>
                    
                   
                    
                    <p:column headerText="Jogos">
                        <div class="player-games">
                            <ui:repeat value="#{jogador.jogos}" var="jogo">
                                <span class="game-badge-small" style="background-color: #{jogo.corHex ne null ? jogo.corHex : '#00e1ff'};">
                                    #{jogo.nome}
                                </span>
                            </ui:repeat>
                        </div>
                    </p:column>
                    
                    <p:column headerText="Ações" style="width: 120px; text-align: center;">
                        <p:link outcome="jogador.xhtml" styleClass="action-icon neon-action">
                            <i class="pi pi-eye"></i>
                            <f:param name="id" value="#{jogador.id}" />
                        </p:link>                       
                        <p:commandLink type="button" styleClass="action-icon danger" onclick="PF('confirmDialog').show()">
                            <i class="pi pi-trash"></i>
                            <f:setPropertyActionListener value="#{jogador}" target="#{managerPlayer.playerSelecionado}" />
                        </p:commandLink>
                    </p:column>
                </p:dataTable>
                
                <!-- Dialog de confirmação de exclusão -->
                <p:confirmDialog widgetVar="confirmDialog" message="Tem certeza que deseja excluir este jogador?" 
                                header="Confirmar Exclusão" severity="alert" closeOnEscape="true">
                    <p:commandButton value="Não" type="button" styleClass="p-button-text" 
                                   onclick="PF('confirmDialog').hide()" />
                    <p:commandButton value="Sim" styleClass="p-button-text p-button-danger" 
                                     actionListener="#{managerPlayer.removerPlayer()}" 
                                   update="jogadoresTable" 
                                   oncomplete="PF('confirmDialog').hide()" />
                </p:confirmDialog>
            </h:form>
        </p:card>
        
        <!-- Estilos adicionais (tema dark elegante) -->
        <style type="text/css">
            /* Card padding - mais espaço no topo */
            .glass-card .ui-card-body,
            .glass-card .p-card-body {
                padding: 1.75rem 1.5rem !important;
            }
            
            /* Filter Grid - seguindo padrão das outras telas */
            .filter-grid {
                display: grid;
                grid-template-columns: 1fr auto;
                gap: 1.5rem 1rem;
                margin-bottom: 1.5rem;
                margin-top: 0.5rem;
            }
            
            /* Filter Field Container */
            .filter-field {
                display: flex;
                flex-direction: column;
                gap: 0.75rem;
            }
            
            /* Filter Labels - seguindo padrão do sistema */
            .filter-label {
                display: flex !important;
                align-items: center !important;
                gap: 0.5rem !important;
                font-size: 0.875rem !important;
                font-weight: 600 !important;
                color: var(--text-200) !important;
                margin: 0 !important;
                padding: 0 !important;
                text-transform: uppercase !important;
                letter-spacing: 0.5px !important;
                line-height: 1.2 !important;
                visibility: visible !important;
                opacity: 1 !important;
            }
            
            .filter-label i {
                color: var(--accent) !important;
                font-size: 0.875rem !important;
                flex-shrink: 0 !important;
            }
            
            .filter-label span {
                color: inherit !important;
            }
            
            .filter-label-empty {
                visibility: hidden !important;
                height: 1.2rem !important;
            }
            
            /* Input Fields - sem ícones dentro, apenas na label */
            .filter-input,
            .filter-input.ui-inputfield,
            .ui-inputfield.filter-input {
                width: 100% !important;
                background: rgba(255,255,255,0.05) !important;
                border: 1px solid rgba(255,255,255,0.12) !important;
                color: var(--text-100) !important;
                font-size: 0.95rem !important;
                padding: 0.75rem 1rem !important;
                transition: all 0.2s ease !important;
                min-height: 46px;
                box-sizing: border-box;
                border-radius: 10px !important;
            }
            
            .filter-input:hover,
            .filter-input:focus,
            .ui-inputfield.filter-input:hover,
            .ui-inputfield.filter-input:focus {
                background: rgba(255,255,255,0.08) !important;
                border-color: rgba(255,255,255,0.2) !important;
            }
            
            .filter-input:focus,
            .ui-inputfield.filter-input:focus {
                border-color: var(--accent) !important;
                box-shadow: 0 0 0 3px rgba(0,225,255,0.15) !important;
                outline: none !important;
            }
            
            .filter-input::placeholder,
            .ui-inputfield.filter-input::placeholder {
                color: var(--text-300) !important;
                opacity: 0.6 !important;
            }
            
            /* Clear button - melhorado seguindo padrão do sistema */
            .clear-btn,
            .clear-btn.p-button,
            .clear-btn.ui-button {
                min-height: 46px !important;
                padding: 0.75rem 1.5rem !important;
                font-weight: 600 !important;
                font-size: 0.9rem !important;
                white-space: nowrap !important;
                background: transparent !important;
                border: 1px solid var(--border) !important;
                color: var(--text-200) !important;
                border-radius: 10px !important;
                transition: all 0.2s ease !important;
                display: inline-flex !important;
                align-items: center !important;
                justify-content: center !important;
                gap: 0.5rem !important;
            }
            
            .clear-btn:hover,
            .clear-btn.p-button:hover,
            .clear-btn.ui-button:hover {
                background: rgba(255,255,255,0.06) !important;
                border-color: var(--accent) !important;
                color: var(--text-100) !important;
                transform: translateY(-1px);
                box-shadow: 0 4px 12px rgba(0,225,255,0.15) !important;
            }
            
            .clear-btn i,
            .clear-btn .pi {
                color: inherit !important;
                font-size: 0.9rem !important;
            }
            
            /* Responsividade */
            @media (max-width: 768px) {
                .filter-grid {
                    grid-template-columns: 1fr;
                    gap: 1rem;
                }
                
                .filter-field:nth-child(2),
                .filter-field:last-child {
                    grid-column: 1;
                }
                
                .filter-label-empty {
                    display: none;
                }
            }

            .player-avatar-small {
                width: 40px;
                height: 40px;
                border-radius: 50%;
                overflow: hidden;
                margin: 0 auto;
            }
            
            .player-photo-small {
                width: 100%;
                height: 100%;
                object-fit: cover;
            }
            
            .player-photo-placeholder-small { display: flex; align-items: center; justify-content: center; width: 100%; height: 100%; font-size: 1.2rem; }
            .player-photo-placeholder-small.dark { background: rgba(255,255,255,0.06); color: #8b93a6; }
            
            .action-icon { color: var(--text-300); margin: 0 0.35rem; font-size: 1.1rem; transition: transform .15s ease, color .15s ease; }
            .action-icon:hover { color: var(--text-100); transform: translateY(-1px); }
            .action-icon.neon-action { color: var(--accent); }
            .action-icon.danger { color: #ef4444; }
            
            .player-games {
                display: flex;
                flex-wrap: wrap;
                gap: .35rem;
            }
            
            .game-badge-small {
                display: inline-block;
                padding: .25rem .6rem;
                border-radius: 999px;
                font-size: .7rem;
                font-weight: 600;
                color: white;
                text-shadow: 0 1px 2px rgba(0,0,0,0.3);
                white-space: nowrap;
            }

        </style>
    </ui:define>
</ui:composition>