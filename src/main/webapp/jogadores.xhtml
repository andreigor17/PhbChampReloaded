<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                template="vercel.xhtml">

    <ui:define name="content">
        <div class="section-header">
            <h1 class="section-title">Jogadores</h1>
            <p:button value="Novo Jogador" icon="pi pi-plus" outcome="criarJogador.xhtml" styleClass="p-button-outlined full-stats-btn" />
        </div>
        
        <p:card styleClass="glass-card">
            <h:form id="jogadoresForm">
                <div class="p-grid">
                    <div class="p-col-12">
                        <div class="p-inputgroup mb-3 search-group">
                            <span class="p-inputgroup-addon glass-addon">
                                <i class="pi pi-search"></i>
                            </span>
                            <p:inputText id="searchInput" placeholder="Buscar jogador..." styleClass="w-100 glass-input" 
                                         value="#{managerPlayer.termoBusca}">
                                <p:ajax event="keyup" listener="#{managerPlayer.pesquisarPlayer()}" 
                                       update="jogadoresTable initialMessage noResultsMessage loadingIndicator" 
                                       delay="500" global="false" />
                            </p:inputText>
                            <span class="p-inputgroup-addon glass-addon">
                                <p:commandButton id="clearButton" icon="pi pi-times" styleClass="p-button-text" 
                                               actionListener="#{managerPlayer.limparBusca()}" 
                                               update="searchInput jogadoresTable initialMessage noResultsMessage" 
                                               process="@this" />
                            </span>
                        </div>
                    </div>
                </div>
                
                <!-- Indicador de carregamento -->
                <p:outputPanel id="loadingIndicator">
                    <div class="text-center p-3" style="display: #{managerPlayer.buscando ? 'block' : 'none'};">
                        <p:progressBar style="width:50px;height:50px"  animationDuration="5" />
                        <div class="mt-2">Buscando jogadores...</div>
                    </div>
                </p:outputPanel>
                
                <!-- Mensagem quando não há resultados -->
                <p:outputPanel id="noResultsMessage">
                    <div class="text-center p-5" style="display: #{managerPlayer.semResultados ? 'block' : 'none'};">
                        <i class="pi pi-search" style="font-size: 3rem; color: #ccc; margin-bottom: 1rem;"></i>
                        <h3>Nenhum jogador encontrado</h3>
                        <p>Tente usar termos diferentes na sua busca.</p>
                    </div>
                </p:outputPanel>
                
                <!-- Mensagem inicial -->
                <p:outputPanel id="initialMessage">
                    <div class="text-center p-5" style="display: #{managerPlayer.estadoInicial ? 'block' : 'none'};">
                        <i class="pi pi-users" style="font-size: 3rem; color: #ccc; margin-bottom: 1rem;"></i>
                        <h3>Digite para buscar jogadores</h3>
                        <p>Os resultados aparecerão aqui conforme você digita.</p>
                    </div>
                </p:outputPanel>
                
                <p:dataTable id="jogadoresTable" var="jogador" value="#{managerPlayer.players}" 
                            styleClass="elegant-table" 
                            style="display: #{managerPlayer.temResultados ? 'table' : 'none'};"
                            emptyMessage="Nenhum jogador encontrado"
                            paginator="true" rows="10"
                            rowsPerPageTemplate="10,20,50"
                            paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                            currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} jogadores">
                    
                    <p:column headerText="Foto" style="width: 80px; text-align: center;">
                        <div class="player-avatar-small">
                            <p:graphicImage value="image/#{jogador.anexo.nome}" rendered="#{jogador.anexo ne null}" styleClass="player-photo-small" />
                            <h:panelGroup rendered="#{jogador.anexo eq null}">
                                <div class="player-photo-placeholder-small dark">
                                    <i class="pi pi-user"></i>
                                </div>
                            </h:panelGroup>
                        </div>
                    </p:column>
                    
                    <p:column headerText="Nome" sortBy="#{jogador.nome}">
                        <h:outputText value="#{jogador.nome}" />
                    </p:column>
                    
                    <p:column headerText="Nickname" sortBy="#{jogador.nick}">
                        <h:outputText value="#{jogador.nick}" />
                    </p:column>
                    
                   
                    
                    <p:column headerText="Jogos">
                        <div class="player-games">
                            <ui:repeat value="#{jogador.jogos}" var="jogo">
                                <span class="game-badge-small" style="background-color: #{jogo.corHex ne null ? jogo.corHex : '#00e1ff'};">
                                    #{jogo.nome}
                                </span>
                            </ui:repeat>
                        </div>
                    </p:column>
                    
                    <p:column headerText="Ações" style="width: 120px; text-align: center;">
                        <p:link outcome="jogador.xhtml" styleClass="action-icon neon-action">
                            <i class="pi pi-eye"></i>
                            <f:param name="id" value="#{jogador.id}" />
                        </p:link>                       
                        <p:commandLink type="button" styleClass="action-icon danger" onclick="PF('confirmDialog').show()">
                            <i class="pi pi-trash"></i>
                            <f:setPropertyActionListener value="#{jogador}" target="#{managerPlayer.playerSelecionado}" />
                        </p:commandLink>
                    </p:column>
                </p:dataTable>
                
                <!-- Dialog de confirmação de exclusão -->
                <p:confirmDialog widgetVar="confirmDialog" message="Tem certeza que deseja excluir este jogador?" 
                                header="Confirmar Exclusão" severity="alert" closeOnEscape="true">
                    <p:commandButton value="Não" type="button" styleClass="p-button-text" 
                                   onclick="PF('confirmDialog').hide()" />
                    <p:commandButton value="Sim" styleClass="p-button-text p-button-danger" 
                                     actionListener="#{managerPlayer.removerPlayer()}" 
                                   update="jogadoresTable" 
                                   oncomplete="PF('confirmDialog').hide()" />
                </p:confirmDialog>
            </h:form>
        </p:card>
        
        <!-- Estilos adicionais (tema dark elegante) -->
        <style type="text/css">
            /* Força tema dark no grupo de busca */
            .search-group .glass-addon { background: rgba(255,255,255,0.04) !important; border: 1px solid rgba(255,255,255,0.08) !important; color: var(--text-300) !important; }
            .search-group .glass-input { background: rgba(255,255,255,0.03) !important; border: 1px solid rgba(255,255,255,0.08) !important; color: var(--text-100) !important; }
            .search-group .glass-input:focus { box-shadow: 0 0 0 1px rgba(0,225,255,0.18), 0 0 16px rgba(0,225,255,0.08); border-color: rgba(0,225,255,0.35) !important; }
            .search-group .glass-input::placeholder { color: #98a2b3; }
            .search-group .ui-inputfield { background: transparent !important; color: var(--text-100) !important; }
            /* Compatibilidade com possíveis classes antigas */
            .search-group .p-inputgroup-addon, .search-group .ui-inputgroup-addon { background: rgba(255,255,255,0.04) !important; border: 1px solid rgba(255,255,255,0.08) !important; color: var(--text-300) !important; }
            .search-group .p-inputtext, .search-group .ui-inputtext { background: rgba(255,255,255,0.03) !important; border: 1px solid rgba(255,255,255,0.08) !important; color: var(--text-100) !important; }

            .player-avatar-small {
                width: 40px;
                height: 40px;
                border-radius: 50%;
                overflow: hidden;
                margin: 0 auto;
            }
            
            .player-photo-small {
                width: 100%;
                height: 100%;
                object-fit: cover;
            }
            
            .player-photo-placeholder-small { display: flex; align-items: center; justify-content: center; width: 100%; height: 100%; font-size: 1.2rem; }
            .player-photo-placeholder-small.dark { background: rgba(255,255,255,0.06); color: #8b93a6; }
            
            .action-icon { color: var(--text-300); margin: 0 0.35rem; font-size: 1.1rem; transition: transform .15s ease, color .15s ease; }
            .action-icon:hover { color: var(--text-100); transform: translateY(-1px); }
            .action-icon.neon-action { color: var(--accent); }
            .action-icon.danger { color: #ef4444; }
            
            .player-games {
                display: flex;
                flex-wrap: wrap;
                gap: .35rem;
            }
            
            .game-badge-small {
                display: inline-block;
                padding: .25rem .6rem;
                border-radius: 999px;
                font-size: .7rem;
                font-weight: 600;
                color: white;
                text-shadow: 0 1px 2px rgba(0,0,0,0.3);
                white-space: nowrap;
            }

        </style>
    </ui:define>
</ui:composition>