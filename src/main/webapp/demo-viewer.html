<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PhbChamp - Visualizador de Demos CS2</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.8;
            font-size: 1.1em;
        }
        
        .content {
            padding: 30px;
        }
        
        .upload-section {
            background: #f7fafc;
            border: 3px dashed #cbd5e0;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            margin-bottom: 30px;
            transition: all 0.3s;
        }
        
        .upload-section:hover {
            border-color: #667eea;
            background: #edf2f7;
        }
        
        .upload-section.dragover {
            border-color: #667eea;
            background: #e6fffa;
            transform: scale(1.02);
        }
        
        .file-input {
            display: none;
        }
        
        .upload-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 50px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        .upload-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }
        
        .loading.active {
            display: block;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .demo-info {
            display: none;
            animation: fadeIn 0.5s;
        }
        
        .demo-info.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .info-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .info-card h3 {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .info-card .value {
            font-size: 1.8em;
            font-weight: bold;
        }
        
        .section-title {
            font-size: 1.5em;
            color: #2d3748;
            margin: 30px 0 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }
        
        .error {
            background: #fff5f5;
            color: #c53030;
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid #e53e3e;
            margin: 20px 0;
        }
        
        .btn-secondary {
            background: #718096;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s;
        }
        
        .btn-secondary:hover {
            background: #4a5568;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .tab {
            padding: 15px 30px;
            background: transparent;
            border: none;
            color: #718096;
            cursor: pointer;
            font-size: 1.1em;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }
        
        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
            font-weight: bold;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }
        
        .team-ct {
            color: #3182ce;
            font-weight: bold;
        }
        
        .team-t {
            color: #e53e3e;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>üéÆ Visualizador de Demos CS2</h1>
            <p>Analise suas partidas de Counter-Strike 2 em detalhes</p>
        </div>
        
        <div class="content">
            <!-- Se√ß√£o de Upload -->
            <div class="upload-section" id="uploadSection">
                <h2 style="margin-bottom: 20px; color: #2d3748;">Carregar Demo</h2>
                <p style="margin-bottom: 20px; color: #718096;">
                    Arraste um arquivo .dem ou .zip aqui, ou clique no bot√£o abaixo
                </p>
                <input type="file" id="fileInput" class="file-input" accept=".dem,.zip" />
                <button class="upload-btn" onclick="document.getElementById('fileInput').click()">
                    üìÅ Selecionar Arquivo
                </button>
            </div>
            
            <!-- Loading -->
            <div class="loading" id="loadingSection">
                <div class="spinner"></div>
                <p>Analisando demo... Isso pode levar alguns segundos.</p>
                <p id="progressText" style="color: #718096; margin-top: 10px;"></p>
            </div>
            
            <!-- Informa√ß√µes do Demo -->
            <div class="demo-info" id="demoInfo">
                <div class="info-grid" id="headerInfo"></div>
                
                <!-- Tabs -->
                <div class="tabs">
                    <button class="tab active" onclick="showTab('overview')">üìä Vis√£o Geral</button>
                    <button class="tab" onclick="showTab('players')">üë• Jogadores</button>
                    <button class="tab" onclick="showTab('rounds')">üîÑ Rounds</button>
                </div>
                
                <!-- Tab: Vis√£o Geral -->
                <div id="tab-overview" class="tab-content active">
                    <h2 class="section-title">üìà Estat√≠sticas Gerais</h2>
                    <div id="overviewContent"></div>
                </div>
                
                <!-- Tab: Jogadores -->
                <div id="tab-players" class="tab-content">
                    <h2 class="section-title">üë• Estat√≠sticas dos Jogadores</h2>
                    <div id="playersContent"></div>
                </div>
                
                <!-- Tab: Rounds -->
                <div id="tab-rounds" class="tab-content">
                    <h2 class="section-title">üîÑ Detalhes dos Rounds</h2>
                    <div id="roundsContent"></div>
                </div>
                
                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn-secondary" onclick="resetViewer()">üîÑ Carregar Outro Demo</button>
                </div>
            </div>
            
            <!-- Error -->
            <div class="error" id="errorSection" style="display: none;"></div>
        </div>
    </div>

    <script>
        let currentDemoData = null;
        
        // Detecta a URL da API automaticamente
        function getApiBaseUrl() {
            // Tenta obter da vari√°vel global (se definida por JSF)
            if (window.API_BASE_URL) {
                return window.API_BASE_URL;
            }
            
            // Detecta automaticamente baseado na URL atual
            const currentUrl = window.location.origin;
            const protocol = window.location.protocol;
            const hostname = window.location.hostname;
            
            // Se estiver em localhost, assume que a API est√° na porta 9090
            if (hostname === 'localhost' || hostname === '127.0.0.1') {
                return protocol + '//' + hostname + ':9090';
            }
            
            // Caso contr√°rio, tenta inferir a partir da URL atual
            // Assumindo que a API est√° no mesmo dom√≠nio mas porta diferente
            // ou em um subdom√≠nio /api
            const port = window.location.port;
            if (port && port !== '80' && port !== '443') {
                // Se houver porta, tenta porta 9090
                return protocol + '//' + hostname + ':9090';
            }
            
            // Fallback: tenta localhost:9090
            return 'http://localhost:9090';
        }
        
        const API_BASE_URL = getApiBaseUrl();
        console.log('API Base URL:', API_BASE_URL);
        
        // Configura√ß√£o de drag and drop
        const uploadSection = document.getElementById('uploadSection');
        const fileInput = document.getElementById('fileInput');
        
        uploadSection.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadSection.classList.add('dragover');
        });
        
        uploadSection.addEventListener('dragleave', () => {
            uploadSection.classList.remove('dragover');
        });
        
        uploadSection.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadSection.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });
        
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        });
        
        async function handleFile(file) {
            // Valida extens√£o
            if (!file.name.endsWith('.dem') && !file.name.endsWith('.zip')) {
                showError('Por favor, selecione um arquivo .dem ou .zip');
                return;
            }
            
            // Valida tamanho (500MB)
            const maxSize = 500 * 1024 * 1024; // 500 MB
            if (file.size > maxSize) {
                showError('Arquivo muito grande. Tamanho m√°ximo: 500 MB. Arquivo atual: ' + 
                    (file.size / (1024 * 1024)).toFixed(2) + ' MB');
                return;
            }
            
            showLoading(true);
            hideError();
            
            // Mostra progresso do upload
            const progressText = document.getElementById('progressText');
            progressText.textContent = 'Enviando arquivo... (' + (file.size / (1024 * 1024)).toFixed(2) + ' MB)';
            
            try {
                const formData = new FormData();
                formData.append('file', file);
                
                progressText.textContent = 'Enviando arquivo para o servidor...';
                
                // Faz upload para a API
                const uploadUrl = API_BASE_URL + '/api/demo/upload';
                console.log('Fazendo upload para:', uploadUrl);
                
                const response = await fetch(uploadUrl, {
                    method: 'POST',
                    body: formData
                });
                
                if (!response.ok) {
                    const errorText = await response.text();
                    let errorMessage = 'Erro ao processar demo';
                    try {
                        const errorData = JSON.parse(errorText);
                        errorMessage = errorData.message || errorMessage;
                    } catch (e) {
                        errorMessage = `HTTP ${response.status}: ${errorText}`;
                    }
                    throw new Error(errorMessage);
                }
                
                progressText.textContent = 'Processando demo...';
                
                const data = await response.json();
                console.log('Resposta da API:', data);
                
                if (data.success) {
                    progressText.textContent = 'An√°lise conclu√≠da!';
                    
                    // A resposta pode ter 'analysis' ou ser o pr√≥prio objeto de an√°lise
                    const analysisData = data.analysis || data;
                    currentDemoData = analysisData;
                    displayDemoInfo(analysisData);
                } else {
                    showError(data.message || 'Erro ao processar demo');
                }
            } catch (error) {
                console.error('Erro detalhado:', error);
                let errorMessage = 'Erro ao enviar arquivo';
                
                if (error.message) {
                    errorMessage = error.message;
                } else if (error.name === 'TypeError' && error.message.includes('fetch')) {
                    errorMessage = 'Erro de conex√£o. Verifique se a API est√° rodando em ' + API_BASE_URL;
                }
                
                showError(errorMessage);
            } finally {
                showLoading(false);
            }
        }
        
        async function loadDemoById(anexoId) {
            if (!anexoId) {
                showError('ID do anexo n√£o fornecido');
                return;
            }
            
            showLoading(true);
            hideError();
            
            const progressText = document.getElementById('progressText');
            progressText.textContent = 'Carregando demo...';
            
            try {
                const analyzeUrl = API_BASE_URL + `/api/demo/analyze/${anexoId}`;
                console.log('Carregando demo de:', analyzeUrl);
                
                const response = await fetch(analyzeUrl);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    let errorMessage = 'Erro ao carregar demo';
                    try {
                        const errorData = JSON.parse(errorText);
                        errorMessage = errorData.error || errorData.message || errorMessage;
                    } catch (e) {
                        errorMessage = `HTTP ${response.status}: ${errorText}`;
                    }
                    throw new Error(errorMessage);
                }
                
                progressText.textContent = 'Processando an√°lise...';
                
                const data = await response.json();
                console.log('Dados do demo:', data);
                
                currentDemoData = data;
                displayDemoInfo(data);
            } catch (error) {
                console.error('Erro ao carregar demo:', error);
                let errorMessage = 'Erro ao carregar demo';
                
                if (error.message) {
                    errorMessage = error.message;
                } else if (error.name === 'TypeError' && error.message.includes('fetch')) {
                    errorMessage = 'Erro de conex√£o. Verifique se a API est√° rodando em ' + API_BASE_URL;
                }
                
                showError(errorMessage);
            } finally {
                showLoading(false);
            }
        }
        
        function displayDemoInfo(data) {
            const headerInfo = document.getElementById('headerInfo');
            const header = data.header || {};
            
            headerInfo.innerHTML = 
                '<div class="info-card">' +
                    '<h3>Mapa</h3>' +
                    '<div class="value">' + (header.mapName || 'N/A') + '</div>' +
                '</div>' +
                '<div class="info-card">' +
                    '<h3>Dura√ß√£o</h3>' +
                    '<div class="value">' + formatDuration(header.duration) + '</div>' +
                '</div>' +
                '<div class="info-card">' +
                    '<h3>Tick Rate</h3>' +
                    '<div class="value">' + (header.tickRate || 'N/A') + '</div>' +
                '</div>' +
                '<div class="info-card">' +
                    '<h3>Servidor</h3>' +
                    '<div class="value" style="font-size: 1.2em;">' + truncate(header.serverName || 'N/A', 20) + '</div>' +
                '</div>';
            
            // Mostra a se√ß√£o de informa√ß√µes
            document.getElementById('demoInfo').classList.add('active');
            document.getElementById('uploadSection').style.display = 'none';
            
            // Preenche as tabs
            populateOverview(data);
            populatePlayers(data);
            populateRounds(data);
        }
        
        function populateOverview(data) {
            const content = document.getElementById('overviewContent');
            const header = data.header || {};
            const additionalInfo = data.additionalInfo || {};
            const isFallback = data.fallback || false;
            
            let html = '<div class="info-grid">' +
                    '<div class="info-card">' +
                        '<h3>Tamanho do Arquivo</h3>' +
                        '<div class="value">' + formatBytes(data.fileSize) + '</div>' +
                    '</div>' +
                    '<div class="info-card">' +
                        '<h3>Total de Mortes</h3>' +
                        '<div class="value">' + (data.totalDeaths || 'N/A') + '</div>' +
                    '</div>' +
                    '<div class="info-card">' +
                        '<h3>Total de Disparos</h3>' +
                        '<div class="value">' + (data.totalShots || 'N/A') + '</div>' +
                    '</div>' +
                '</div>';
            
            if (isFallback) {
                html += '<div style="background: #fff5f5; padding: 20px; border-radius: 10px; margin-top: 20px; border-left: 4px solid #ef4444;">' +
                    '<h3 style="margin-bottom: 15px; color: #c53030;">‚ö†Ô∏è An√°lise Limitada</h3>' +
                    '<p style="color: #c53030;">' + (data.error || 'An√°lise detalhada n√£o dispon√≠vel') + '</p>' +
                    '<p style="color: #718096; margin-top: 10px;"><strong>Instale o demoparser2:</strong> pip install demoparser2</p>' +
                '</div>';
            } else {
                html += '<div style="background: #e6fffa; padding: 20px; border-radius: 10px; margin-top: 20px; border-left: 4px solid #00e1ff;">' +
                    '<h3 style="margin-bottom: 15px; color: #2d3748;">‚úÖ An√°lise Completa</h3>' +
                    '<p style="color: #718096;">An√°lise detalhada usando <strong>demoparser2</strong> (Python)</p>' +
                '</div>';
            }
            
            html += '<div style="background: #f7fafc; padding: 20px; border-radius: 10px; margin-top: 20px;">' +
                '<h3 style="margin-bottom: 15px; color: #2d3748;">‚ÑπÔ∏è Informa√ß√£o</h3>' +
                '<p style="color: #718096;">' +
                    '<strong>Servidor:</strong> ' + (header.serverName || 'N/A') + '<br/>' +
                    '<strong>Protocolo:</strong> ' + (header.protocol || 'N/A') + '<br/>' +
                    '<strong>Caminho:</strong> ' + (additionalInfo.filePath ? truncate(additionalInfo.filePath, 50) : 'N/A') +
                '</p>' +
            '</div>';
            
            content.innerHTML = html;
        }
        
        function populatePlayers(data) {
            const content = document.getElementById('playersContent');
            const playerStats = data.playerStats || [];
            
            if (playerStats.length === 0) {
                content.innerHTML = '<div style="background: #f7fafc; padding: 40px; border-radius: 10px; text-align: center; color: #718096; font-style: italic;">' +
                    'Estat√≠sticas de jogadores n√£o dispon√≠veis.' +
                '</div>';
                return;
            }
            
            let html = '<div style="overflow-x: auto;"><table style="width: 100%; border-collapse: collapse; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">' +
                '<thead style="background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%); color: white;">' +
                    '<tr>' +
                        '<th style="padding: 15px; text-align: left;">Jogador</th>' +
                        '<th style="padding: 15px;">Time</th>' +
                        '<th style="padding: 15px;">K</th>' +
                        '<th style="padding: 15px;">D</th>' +
                        '<th style="padding: 15px;">K/D</th>' +
                        '<th style="padding: 15px;">HS%</th>' +
                        '<th style="padding: 15px;">Arma Favorita</th>' +
                    '</tr>' +
                '</thead>' +
                '<tbody>';
            
            playerStats.forEach(player => {
                const teamClass = player.team.toLowerCase().includes('ct') ? 'team-ct' : 'team-t';
                html += '<tr style="border-bottom: 1px solid #e2e8f0; transition: all 0.2s;" onmouseover="this.style.background=\'#f7fafc\'" onmouseout="this.style.background=\'transparent\'">' +
                    '<td style="padding: 15px;"><strong>' + (player.playerName || 'Unknown') + '</strong></td>' +
                    '<td style="padding: 15px; text-align: center;"><span class="' + teamClass + '" style="font-weight: bold;">' + (player.team || 'N/A') + '</span></td>' +
                    '<td style="padding: 15px; text-align: center;">' + (player.kills || 0) + '</td>' +
                    '<td style="padding: 15px; text-align: center;">' + (player.deaths || 0) + '</td>' +
                    '<td style="padding: 15px; text-align: center;">' + (player.kdr ? player.kdr.toFixed(2) : '0.00') + '</td>' +
                    '<td style="padding: 15px; text-align: center;">' + (player.headshotPercentage ? player.headshotPercentage.toFixed(1) : '0.0') + '%</td>' +
                    '<td style="padding: 15px; text-align: center;"><code style="background: #667eea; color: white; padding: 5px 10px; border-radius: 5px; font-size: 0.9em;">' + (player.favoriteWeapon || 'N/A') + '</code></td>' +
                '</tr>';
            });
            
            html += '</tbody></table></div>';
            content.innerHTML = html;
        }
        
        function populateRounds(data) {
            const content = document.getElementById('roundsContent');
            const rounds = data.rounds || [];
            
            if (rounds.length === 0) {
                content.innerHTML = '<div style="background: #f7fafc; padding: 40px; border-radius: 10px; text-align: center; color: #718096; font-style: italic;">' +
                    'Informa√ß√µes de rounds n√£o dispon√≠veis.' +
                '</div>';
                return;
            }
            
            let html = '';
            rounds.forEach(round => {
                const kills = round.kills || [];
                html += '<div style="background: white; border-radius: 10px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); border-left: 5px solid #667eea;">' +
                    '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">' +
                        '<div style="font-size: 1.3em; font-weight: bold; color: #2d3748;">Round ' + (round.roundNumber || 0) + '</div>' +
                        '<div><strong>Vencedor:</strong> <span style="color: #667eea; font-weight: bold;">' + (round.winner || 'N/A') + '</span></div>' +
                    '</div>';
                
                if (round.winReason) {
                    html += '<div style="margin-bottom: 10px; color: #718096;"><strong>Motivo:</strong> ' + round.winReason + '</div>';
                }
                
                if (kills.length > 0) {
                    html += '<div style="margin-top: 15px;"><strong>Kills (' + kills.length + '):</strong><ul style="list-style: none; padding: 0; margin-top: 10px;">';
                    
                    kills.slice(0, 10).forEach(kill => {
                        const headshotBadge = kill.headshot ? '<span style="background: #e53e3e; color: white; padding: 3px 8px; border-radius: 3px; font-size: 0.8em; font-weight: bold; margin-left: 5px;">HS</span>' : '';
                        html += '<li style="padding: 10px; margin: 5px 0; background: #f7fafc; border-radius: 5px; display: flex; align-items: center; gap: 10px;">' +
                            '<span style="font-weight: bold;">' + (kill.killerName || 'Unknown') + '</span>' +
                            '<span style="background: #667eea; color: white; padding: 5px 10px; border-radius: 5px; font-size: 0.9em;">' + (kill.weapon || 'unknown') + '</span>' +
                            headshotBadge +
                            '<span>‚Üí</span>' +
                            '<span>' + (kill.victimName || 'Unknown') + '</span>' +
                        '</li>';
                    });
                    
                    if (kills.length > 10) {
                        html += '<li style="padding: 10px; text-align: center; color: #718096; font-style: italic;">... e mais ' + (kills.length - 10) + ' kills</li>';
                    }
                    
                    html += '</ul></div>';
                }
                
                html += '</div>';
            });
            
            content.innerHTML = html;
        }
        
        function showTab(tabName) {
            // Remove active de todas as tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Ativa a tab selecionada
            event.target.classList.add('active');
            document.getElementById('tab-' + tabName).classList.add('active');
        }
        
        function showLoading(show) {
            document.getElementById('loadingSection').classList.toggle('active', show);
        }
        
        function showError(message) {
            const errorSection = document.getElementById('errorSection');
            errorSection.innerHTML = '<strong>‚ùå Erro:</strong> ' + message + 
                '<br/><small style="color: #718096; margin-top: 10px; display: block;">' +
                'Verifique se a API est√° rodando em ' + API_BASE_URL + '</small>';
            errorSection.style.display = 'block';
            
            // Scroll para o erro
            errorSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
        
        function hideError() {
            document.getElementById('errorSection').style.display = 'none';
        }
        
        function resetViewer() {
            document.getElementById('uploadSection').style.display = 'block';
            document.getElementById('demoInfo').classList.remove('active');
            document.getElementById('fileInput').value = '';
            currentDemoData = null;
            hideError();
        }
        
        // Fun√ß√µes utilit√°rias
        function formatDuration(seconds) {
            if (!seconds) return 'N/A';
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return mins + ':' + (secs < 10 ? '0' : '') + secs;
        }
        
        function formatBytes(bytes) {
            if (!bytes) return 'N/A';
            const mb = bytes / (1024 * 1024);
            if (mb >= 1) return mb.toFixed(2) + ' MB';
            return (bytes / 1024).toFixed(2) + ' KB';
        }
        
        function truncate(str, maxLength) {
            if (!str) return 'N/A';
            if (str.length <= maxLength) return str;
            return str.substring(0, maxLength) + '...';
        }
        
        // Verifica se h√° um ID de anexo na URL
        const urlParams = new URLSearchParams(window.location.search);
        const anexoId = urlParams.get('anexoId');
        if (anexoId) {
            loadDemoById(anexoId);
        }
    </script>
</body>
</html>

